
\documentclass{article}



\usepackage{pgf} %nice pictures
\usepackage{rotating}

\usepackage[left=1.0in,right=1.0in,top=1.0in,bottom=1.0in]{geometry} % sets the margins
\usepackage{fancyhdr}
\usepackage{setspace}

 
\usepackage{titlesec}
\usepackage{natbib}
\usepackage{checkend}   % better error messages on left-open environments
\usepackage{graphicx}   % for incorporating external images




\usepackage{times,mathptmx,courier}
\usepackage[scaled=1]{helvet}


% Math or theory people may want to include the handy AMS macros
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{float}


\usepackage[printonlyused,nohyperlinks]{acronym}

\usepackage{comment}


%% url: for typesetting URLs and smart(er) hyphenation.
%% \url{http://...} 
\usepackage{url}

\usepackage{gensymb}

\usepackage{lineno}


\usepackage[icelandic,spanish,english]{babel}
\usepackage[latin1]{inputenc}
\usepackage[T1]{fontenc}

\usepackage{listings}


%% The caption package provides support for varying how table and
%% figure captions are typeset.
\usepackage[format=hang,indention=-1cm,labelfont={bf},margin=1em]{caption}
\lstset{basicstyle=\sffamily\scriptsize,showstringspaces=false,fontadjust}

%move all figures to the end
\usepackage[nomarkers,nofiglist,notablist]{endfloat}


\newcommand{\lang}{\textsf} %
\newcommand{\code}{\texttt}
\newcommand{\pkg}{\texttt}
\newcommand{\ques}[1]{{\bf\large#1}}
\newcommand{\eb}{\\ \nonumber} 


\bibpunct{(}{)}{;}{a}{}{;}


\doublespacing






\titleformat*{\section}{\singlespacing\raggedright\bfseries\Large}
\titleformat*{\subsection}{\singlespacing\raggedright\bfseries\large}
\titleformat*{\subsubsection}{\singlespacing\raggedright\bfseries}
\titleformat*{\paragraph}{\singlespacing\raggedright\itshape}





\usepackage[bookmarks,bookmarksnumbered,%
    citebordercolor={0.8 0.8 0.8},filebordercolor={0.8 0.8 0.8},%
    linkbordercolor={0.8 0.8 0.8},%pagebordercolor={0.8 0.8 0.8},
    urlbordercolor={0.8 0.8 0.8},
    linktocpage%
    ]{hyperref}
%%\usepackage[bookmarks,bookmarksnumbered,%
%%    citebordercolor={0.8 0.8 0.8},filebordercolor={0.8 0.8 0.8},%
%%    linkbordercolor={0.8 0.8 0.8},pagebordercolor={0.8 0.8 0.8},%
%%    urlbordercolor={0.8 0.8 0.8},%
%%    pagebackref,linktocpage%
%%    ]{hyperref}
%% The following change how the the back-references text is typeset in a
%% bibliography when `backref' or `pagebackref' are used
%\renewcommand\backrefpagesname{\(\rightarrow\) pages}
%\renewcommand\backref{\textcolor{greytext} \backrefpagesname\ }

%allow use of \degree command
\usepackage{gensymb}

\usepackage{lineno}
\linenumbers
\bibpunct{(}{)}{;}{a}{}{;}



%% The following is used for tables of equations.
\newcounter{saveEq} 
\def\putEq{\setcounter{saveEq}{\value{equation}}} 
\def\getEq{\setcounter{equation}{\value{saveEq}}} 
\def 
\tableEq{ 

% equations in tables
\putEq \setcounter{equation}{0} 
\renewcommand{\theequation}{T\arabic{table}.\arabic{equation}} \vspace{-5mm} } 
\def\normalEq{ 

% renew normal equations
\getEq 
\renewcommand{\theequation}{\arabic{section}.\arabic{equation}}}
\newcommand{\normal}[2]{\ensuremath{N(#1,#2)}}





%%%%%%%% Author macros begin:
\newcommand*{\affaddr}[1]{#1} % No op here. Customize it for different styles.
\newcommand*{\affmark}[1][*]{\textsuperscript{#1}}
\newcommand*{\email}[1]{\texttt{#1}}
%%%%%%%% Author macros end



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% Some special settings that controls how text is typeset
%%
 \raggedbottom      % pages don't have to line up nicely on the last line
% \sloppy       % be a bit more relaxed in inter-word spacing
 \clubpenalty=10000 % try harder to avoid orphans
 \widowpenalty=20000    % try harder to avoid widows
% \tolerance=1000



\begin{document}

\title{Stock Reduction Analysis using catch at length data: Length-SRA}   

\author{%
Catarina Wor\affmark[1,a,*], Brett van Poorten\affmark[1,2,b], Roberto Licandeo \affmark[1,c],\\ and Carl J. Walters\affmark[1,d] \\
\affaddr{\affmark[1]Institute for the Oceans and Fisheries, University of British Columbia, 2202 Main Mall,\\
 Vancouver, BC Canada, V6T 1Z4}\\
\affaddr{\affmark[2] British Columbia Ministry of Environment, 2202 Main Mall, Vancouver, BC, Canada, V6T 1Z4}\\
\email{\affmark[a]c.wor@oceans.ubc.ca}\\
\email{\affmark[b]Brett.VanPoorten@gov.bc.ca}\\
\email{\affmark[c]robertolicandeo@gmail.com}\\
\email{\affmark[d]c.walters@oceans.ubc.ca}\\
%,
 \affmark[*]Corresponding author, phone:+1 604 908 4626
}



\maketitle

\begin{abstract}
Many modern stock assessments include age- or length-based selectivity in their list of estimable parameters, often using simple parametric functions describing asymptotic or dome-shaped selectivity. We present a length-based stock reduction analysis (Length-SRA), which bypasses the requirement of estimating selectivity by calculating exploitation rate at length directly from observed catch at length data. We test the performance of Length-SRA with a simulation-evaluation framework under three exploitation rate trajectories and under fixed and time-varying selectivity scenarios. We also explore the impacts of misspecification of growth parameters. The model yields low bias in parameter estimates and management benchmarks and is relatively accurate when tracking changes in selectivity through time. We use Length-SRA to assess two species, Pacific hake and Peruvian jack mackerel, showing that selectivity is quite variable in both species over time, leading to time-varying management reference points.  Length-SRA provides assessment results with accuracy comparable to other methods, such as Virtual Population Analysis and Statistical Catch at Age with the additional advantage of providing estimates of selectivity over time.



\end{abstract}{\bf Keywords:} stock assessment, time-varying selectivity, length composition.



\section{Introduction}


Modern stock assessments typically attempt to fit population dynamics models to catch at age and catch at length data, in hopes of extracting information from these data about age/size selectivity, cohort strength and fishing mortality patterns \citep{hilborn_quantitative_1992,methot_stock_2013}. Some assessment methods attempt to put aside the length frequency data, by converting these data to age compositions using age-from-length tables, perhaps using iterative methods to estimate proportions of fish at age for each length interval \citep{kimura_mixtures_1987}. In cases where age data are lacking, models like MULTIFAN-CL attempt to obtain estimates of selectivity, fishing mortality and population dynamics parameters only from size distribution data \citep{fournier_multifan-cl:_1998}. Combined with a few assumptions regarding the structure and variability in length at age, this procedure can even be used to attempt to recover information about changes in body growth patterns if there is a strong age-class signal in the length frequency data \citep{fournier_multifan-cl:_1998}. It is typical for assessment results from length-based assessment models to show substantial deviations between predicted and observed length distributions of catches, reflecting both sampling variation in the length composition data and incorrect assumptions about the shapes and stability of growth and selectivity patterns \citep{hilborn_quantitative_1992}. 

% If the introduction was re-framed to encompass the issues of (1) the debate on whether to fit to the abundance index or length data, as is heavily discussed in the literature, and (2) better accounting for the selectivity process. This could perhaps be better linked with a discussion of SRA vs. SCA approaches? By discussing specific assessments that would benefit from this approach?

When dealing with length based stock assessments, it is not uncommon to encounter conflict between data types. For example, conflict between an index of abundance and lengh composition data \citep{punt_review_2013}.
For many of the lengh-based assessment models, the poor fit to the length composition data arrise from the inability of the models to track changes in fisheries selectivity over time \citep{gulland_review_1992,punt_review_2013}. Changes in fisheries selectivity over time are thought to occur for many fisheries, and if not taken into account can lead to biased assessment results. However, many data-poor  assessment methods have to rely on constant selectivity assumptions \citep{gulland_review_1992,rudd_accounting_2017}.   

 
Selectivity to fishing is the combination of two processes: vulnerability to the fishing gear and availability of the fished population in the area being fished \citep{beverton_dynamics_1957}. Both processes can vary over time and therefore modify the resulting selectivity. Although selectivity process can often be directly measured through gear experiments, availability is generally harder to measure as it depends on the size-based distribution of the exploited population and the spatial distribution of the fishing fleet. Fish movement, size-structured changes in fish distribution, and changes in fleet distribution, can all affect availability and consequently lead to selectivity changes. Changes in selectivity are not uncommon \citep{sampson_exploration_2012} but are usually difficult to track over time. This difficulty is associated with an inability to distinguish between changes in fishing mortality and changes in selectivity in most age- and length-based stock assessment methods. For this reason, many assessment methods rely on ad hoc parametric selectivity models that may or may not include changes over time \citep{maunder_selectivity:_2014}. If misspecified, such models might lead to severe bias in fishing mortality estimates and other model parameters, which could result in misleading management advice \citep{martell_towards_2014}. 

 Here we suggest an alternative approach to assessment modeling that begins by assuming that the assessment model should exactly reproduce the observed catch at length composition. This approach follows the dynamics of an age structured stock reduction analysis (SRA) \citep{walters_stochastic_2006,kimura_generalized_1984,kimura_stock_1982} which follows a ``conditioned on catch'' format, in which catch composition is assumed to be known without error. The observed catches at age are then subtracted from modeled numbers at age to project numbers at age over time. A good review of SRA-type models is provided in \citet{thorson_catch_2015}. The assumption of known catch composition is analogous to the classical assumption in virtual population analysis that reconstructed numbers at age should exactly match observed catch at age data \citep{hilborn_quantitative_1992}. The suggested approach may have two key advantages over statistical catch at age and/or catch at length models: (1) it does not require estimation of age or size selectivity schedules, and (2) catch at length data are commonly available for every year, even when age composition sampling has not been conducted. 


 We named this approach a Length-SRA assessment model. Here we present the model formulation, demonstrate its performance with a simulation-evaluation analysis and apply it to real fisheries data from the Peruvian jack mackerel (\emph{Trachurus murphyi}) and Pacific hake (\emph{Merluccius productus}) fisheries. 



\section{Methods}

%In this section we describe the stock reduction analysis with catch at length data (Length-SRA), describe the simulation analysis and scenarios used to test the model and provide a description of the real data used to illustrate the model applicability.


\subsection{Stock reduction analysis with catch at length data - length-SRA}

The stock reduction analysis (SRA) described here proceeds through the following steps: (1) compute numbers at age (based on recruitment estimates and mortality in the previous year); (2) convert numbers at age into numbers at length using the proportions of individuals at length given each age class; (3) calculate the exploitation rate at length using numbers at length and observed catch at length; (4) convert the exploitation rate at length to exploitation rate at age; (5) compute numbers in the following year using the exploitation rate at age, natural mortality, and recruitment estimates. 

 The model requires data on length composition of catch in numbers (used in step 3), a prior distribution for the recruitment compensation ratio, and a survey index of abundance that is used to tune the model parameters to the most likely stock abundance trajectory. The model also requires good estimates of growth parameters, variability around mean lengh at age, and natural mortality. The stock assessment and simulation routines were written in ADMB \citep{fournier_ad_2012} and are available on \url{github.com/catarinawor/length_SRA}.

A crucial component of the length-SRA is the calculation of proportions of individuals at length given each age class ($P_{l|a}$ - eqs. \ref{Pla}-\ref{Pla5}). The calculation of such proportions (eq. \ref{Pla}) relies on four main assumptions regarding the distribution of length at age: (1) The mean length at age follows a von Bertalanffy growth curve (eq.\ref{Pla4}), (2) The length at age is normally distributed (eqs. \ref{Pla} -\ref{Pla3}), (3) The standard deviation of the length at age is defined (e.g. eq.\ref{Pla5}), and (4) $P_{L|a}$ is constant for all lengths equal or greater than a maximum length $L$ (eq.\ref{Pla3}).



 The proportions of length at age are used to convert the length-based quantities into age-based quantities which are used to propagate the age structured population dynamics forward (Table \ref{tab:eqsPD}). We assume that recruitment follows a Beverton-Holt type recruitment curve (eq. \ref{PD1}), that harvesting occurs over a short, discrete season in each time step (year or shorter), and that natural survival rate is known and constant over time (eqs. \ref{PD1}-\ref{PD5}). The computation of numbers at age in the initial year (i.e., first year in which data is reported, $t_{init}$) is different from that in the remaining years (eq. \ref{AO1}). Recruitment in the initial year is given by the parameter $R_{init}$ which is used to indicate that the population was not at equilibrium at the start of the time series. 

We used equilibrium spawner per recruit (SPR) quantities to calculate management targets, for illustration purposes we use 40\% as a SPR target and use  ${Yield}_{SPR=40\%}$ and $U_{SPR=40\%}$ as target management benchmarks (Table \ref{tab:eqsOMmsy} - eqs.\ref{lz} to \ref{umsy}). As in all spawner per recruit calculations, our $Yield_{target}$ and $U_{target}$ estimates depend on the selectivity curves calculated for each year (eq. \ref{phieq}).  


 To assess how well the model tracked changes in selectivity over time, we calculated the resulting selectivity estimates by normalizing the yearly vectors of exploitation rate at length ($U_{l,t}$) by the yearly average exploitation rate at length ($\bar{U_{l}}$) (eq. \ref{sel.est}), which is more stable than the maximum yearly exploitation rate ($max{U_{l}}$). This happens because observation errors tend to average out over the length classes, diminishing variability of $\bar{U_{l}}$ in relation to $max{U_{l}}$. When calculating the management targets, we used the same method to calculate the mean selectivity at age (eq. \ref{selage.est}), however we also averaged the selectivity at age curves over the past two years (eq. \ref{selage.est}) in order to further smooth the curves.   



\begin{table}
  %\centering
  %\large
\caption{ \large Indexes, variable definition, and values used in simulation-evaluation}\label{tab:defPD} 
\begin{tabular}{l c p{7.5cm}} 
\hline
Symbol & Value  & Description \\  
\hline
  $l$ & $\{l_o,...,L\}$ &Central point of length bin,  $L=50$ cm\\
  $a$ & $\{a_o,...,A\}$ &Age-class, $A= 20$ years\\  
  $t$ & $\{1,...,T\}$ &Annual time step, $T=50$ years\\
  $a_o$ & $1$ &First age or age of recruitment \\
  $l_{bin}$ & $2$ cm &Size of length bin \\
  $l_o$ & $8$ cm &Central point of first length bin \\
  $init$ & $21$ &Annual time step in which data starts to be reported \\
\hline
Distribution of length given age&&\\
${L_{\infty}}$ &50 cm & Maximum average length\\
${K}$ &0.3& Rate of approach to $L_{\infty}$\\
${t_o}$& -0.1&Theoretical time in which length of individuals is zero\\
$cv_l$ & 0.08 & Coefficient of variation for length at age curve\\
$P_{l|a}$ & &Matrix of proportions of length at age\\
$\Phi$ && Standard normal distribution\\
$zl_{a,l}$ &&Normalized $z$ score for lower limit length bins\\
$zu_{a,l}$&& Normalized $z$ score for upper limit length bins \\
$bl_{l}$ &&  Lower limit of length bins\\
$bu_{l}$ &&  Upper limit of length bins \\    
$\bar{L}_a$&&   Mean length at age\\
$\sigma_{L}$ && Standard deviation of length at age\\
\hline
Population dynamics&&\\
$R_o$& 100& Average unfished recruitment\\
$\kappa$ &10&  Goodyear recruitment compensation ratio\\
$S$ &0.7& Natural annual survival \\
$\sigma_{R} $& 0.6 & standard deviation for recruitment deviations\\
$w_t$& $\mathcal{N}(0,\sigma_{R})$ &  Recruitment deviations for  years \{init-A-$a_o$,...,T\} \\
$N_{a,t}$ &&  Numbers of fish at age and time\\
$SB_{t}$ && Spawning biomass at time\\
$mat_a$ && Proportion of mature individuals at age\\
$a_{rec}, b_{rec}$ && Beverton \& Holt stock recruitment parameters \\
$VB_{t}$ && Biomass that is vulnerable to the survey at time t\\
$v_{a}$ & \{0,0.5,1,...,1\}& Survey vulnerability at age\\
%$R_{init}$& & Recruitment in the year data starts to be reported \\
$U_{a,t}$ && Exploitation rate at age and time\\
$U_{l,t}$ && Exploitation rate at length and time \\
$C_{l,t}$ && Catch at length and time\\
$N_{l,t}$ && Numbers at length and time \\
$lx_a$ && Unfished survivorship at age\\
$\phi_e$ && Unfished average spawning biomass per recruit \\
$\widehat{sel_{l,t}} $ && Selectivity estimates at length and time \\
\hline
\hline
\end{tabular}
\end{table}

\begin{table}
  %\centering
  %\large
\caption{ \large Indexes, variable definition for operating model, MSY quantities, and values used in simulation-evaluation}\label{tab:defOMmsy} 
\begin{tabular}{l p{3.5cm} p{7.5cm}} 
\hline
Symbol & Value  & Description \\  
\hline
Operating model &&\\
$sel_{l,t}$ && Fishing selectivity at length and time\\
$g,d,k$ &vary by scenario& Parameters for selectivity function \\
$U_{t}$ &vary by scenario&  Annual maximum exploitation rate \\
$I_{t}$ && Index of abundance at time \\
$\sigma_{I_t} $& 0.2 & standard deviation for index of abundance deviates\\
$q$ &1.0& Catchability coefficient \\
$\tau$ &&multivariate logistic error term with $\sigma_{\tau} = 0.1$\\
\hline
Management quantities &&\\
$lz_a$&& Fished survivorship at age\\
$F_z$&seq(0.0,1.0,by=0.001)& Hypothetical average fishing mortality to calculate management targets\\
$\phi_z$ && Average spawning biomass per recruit\\
$\phi_{eq}$&& Average exploited biomass per recruit under $U_z$\\
$rsel_{a,t}$&& Realized selectivity at age and time t \\
$R_{eq}$ &&Average equilibrium recruitment under $U_z$\\
${Yield}_{z}$ &&Equilibrium yield under $U_z$\\
${Yield}_{target}$  && Yield that would reduce spawner per recruit to 40\% of unfished levels\\
$U_{target}$ &&Exploitation rate that reduce spawner per recruit to 40\% of unfished levels \\  
\hline
\hline
\end{tabular}
\end{table}


\begin{table}
  %\centering
  %\large
\caption{population dynamics for Length-SRA and operating model}\label{tab:eqsPD} 
\tableEq
    \begin{align}
          % \hline
        %\hline \nonumber \\ 
            \hline  
           \text{Distribution of length given age}&&\nonumber\\
           \hline  
           \label{Pla}        
            P_{l|a} &= \begin{cases} \int_{zl_{a,l}}^{zu_{a,l}}{ \Phi(z) dz},  &\quad l<L \\
             \int_{zl_{a,l}}^{\infty}{ \Phi(z) dz},  &\quad l=L \\
             \end{cases}\\
            \label{Pla2}
            zl_{a,l} &= \frac{bl_{l} - \bar{L}_{a}}{\sigma_{L_{a}}} \\
            \label{Pla3}
            zu_{a,l} &= \frac{bu_{l} - \bar{L}_{a}}{\sigma_{L_{a}}}  \\
            \label{Pla4} 
            \bar{L}_{a} &= L_{\infty} \cdot (1 - e^{(-K\cdot(a-t_o))})  \\
            \label{Pla5} 
            \sigma_{L_{a}} &= \bar{L}_{a} \cdot cv_l  \\
            %\nonumber \\
            \hline  
            \mbox{Population dynamics}&&\nonumber\\
            \hline
            \label{PD1}
             N_{a,t>init}&=\begin{cases} \frac{a_{rec} \cdot SB_{t-1}}{1+ b_{rec} \cdot SB_{t-1}} \cdot e^{w_t- \frac{\sigma^{2}_{R}}{2}}, &\quad a=a_o  \\
            %
            N_{a-1,t-1}\cdot S \cdot (1-U_{a-1,t-1}),&\quad a_o<a<A  \\
            %
            \frac{N_{a-1,t-1} \cdot S \cdot (1-U_{a-1,t-1})}{1- S \cdot (1-U{a,t})},&\quad a=A \\
            \end{cases}\\
            \label{PD2}
            U_{a,t}&=\sum_l{(P_{l|a}\cdot U_{l,t})}\\
            \label{PD3}
            U_{l,t}&=\frac{C_{l,t}}{N_{l,t}}\\
            \label{PD4}
            N_{l,t}&=\sum_a{(P_{l|a}\cdot N_{a,t})}\\
            \label{PD5}
            SB_{t}&= \sum_a(mat_a \cdot w_a \cdot N_{a,t}) \\ 
            \label{sel.est}
            \widehat{sel_{l,t}}&=  \frac{U_{l,t}}{\bar{U_{t}}} \\
            \label{vb}
            VB_{t}&=  \sum^a{N_{a,t} \cdot  w_a} \\
            \hline 
            \mbox{Initial year and incidence functions} &&\nonumber \\ 
            \hline 
            \label{AO1}
            %N_{a=1,init}&= R_{init} \cdot e^{w_{init}} \\
             N_{a,t=init}&= lx_a \cdot R_{o} \cdot e^{(w_{t=init}...w_{t=init-A+a_o} - \frac{\sigma^{2}_{R}}{2})}\\
            \label{AO2}
            a_{rec}&=  \frac{\kappa}{\phi_e} \\
            \label{AO4}
            b_{rec}&= \frac{\kappa-1}{R_o \cdot \phi_e}  \\
             \label{AO5}
            \phi_e &= \sum_a{lx_a \cdot mat_a \cdot w_a} \\
            \label{AO6}
            lx_a &= \begin{cases} 1 , &\quad a=1 \\
            lx_{a-1} \cdot S ,&\quad 1<a<A \\ 
            \frac{lx_{a-1} \cdot S}{1-S} ,&\quad a=A \\
             \end{cases}\\       
        \hline \hline \nonumber
    \end{align}
    \normalEq
\end{table}


The Length-SRA model estimates three main parameters: average unexploited recruitment $R_{0}$, recruitment compensation ratio $\kappa$, and recruitment in the initial year $R_{init}$. In addition, the annual recruitment deviations $w_t$ are estimated for all cohorts observed in the model. That is, the number of recruitment deviations is equal to the number of years in the time series plus the number of age classes greater than recruitment age.  



\begin{table}
\caption{Management quantities and operating model}\label{tab:eqsOMmsy} 
\tableEq
    \begin{align}
           \hline
            \mbox{Operating model}&&\nonumber\\
            \hline
            \label{OM}
             N_{a,t=1}&= lx_a \cdot R_o\\
            \label{OM1}
            U_{l,t}&= U_{t} \cdot sel^{OM}_{l,t}\\
            \label{OM2}          
            C_{l,t}&= N_{l,t} \cdot  U_{l,t} \cdot P_{l|a} \cdot \tau \\
            \label{OM3}
            sel_{l,t} &= \frac{1}{1-g}\cdot \left(\frac{1-g}{g}\right)^{g} \cdot \frac{e^{d\cdot g\cdot (k-l)}}{1+e^{d\cdot(k-l)}}\\
            \label{OM4}
            I_{t}&= q \cdot VB_{t} \cdot e^{(\mathcal{N}(0,\sigma_{I_t}))}\\ 
            \hline  
           \text{Management quantities}&&\nonumber\\
           \hline
            \label{lz}
            lz_a &= \begin{cases} lz_a=1 &\quad a=a_o\\
              lz_{a-1}\cdot S \cdot exp(-F_z \cdot  rsel_{a-1,t}) &\quad a_o<a<A\\
              \frac{lz_{a-1}\cdot S \cdot exp(-F_z \cdot  rsel_{a-1,t})}{1-S\cdot exp(-F_z \cdot  rsel_{A,t})}&\quad a=A\\\end{cases}\\
              \label{selage.est}
             rsel_{a,t} &= \frac{\frac{U_{a,t-1}}{\bar{U}_{t-1}}+ \frac{U_{a,t}}{\bar{U}_{t}}}{2}\\
            \label{phiz}
            \phi_z &= \sum_a{lz_a \cdot mat_a \cdot w_a}\\
            \label{phieq}
            Target_{\phi} &= |\frac{\phi_z}{\phi_e}-0.4| \\
            \label{phitarget}
            \phi_{eq} &= \sum_a{lz_a \cdot  (1-exp(-F_z*rsel_{a,t})) \cdot w_a} \\
             \label{Req}
             R_{eq} &= R_o \cdot \frac{\kappa - \phi_e/\phi_z}{\kappa-1}\\
             \label{yz}
             Yield_z&= R_{eq}\cdot \phi_{eq}\\
             \label{msy}
             Yield_{target} &= Yield_z  \textnormal{ associated with } min(Target_{\phi}) \\
             \label{umsy}
             U_{target} &= 1-exp(-F_z) \textnormal{ associated with } min(Target_{\phi})\\
        \hline \hline \nonumber
    \end{align}
    \normalEq
\end{table}



The objective function (eq. \ref{Obj}) is composed of a negative log-likelihood component, one penalty, and a prior component for the recruitment compensation ratio $\kappa$. The negative log-likelihood component minimizes the differences between the predicted and observed index of abundance (eq. \ref{PLL1}). We assume that such differences are lognormally distributed (eqs. \ref{PLL3}-\ref{PLL4}) and use the conditional maximum likelihood estimator described by \citet{walters_calculation_1994} to estimate the survey catchability coefficient $q$ (eq. \ref{PLL2}). A lognormal penalty is added to the negative log-likelihood function to constrain annual recruitment residuals so  estimates have mean of zero and fixed standard deviation $\sigma_{R}$ \citep{maunder_estimation_2003} (eq. \ref{pen.1}). This penalty was applied differently in the ADMB parameter estimation phases \citet{fournier_ad_2012}. The value for the standard deviation for recruitment deviations ($\sigma_{R}$) was set to the input value for most estimation phases, however in the last estimation phase, the value for $\sigma_{R}$ was multiplied by 2. This procedure was based on the findings of \citet{schnute_estimating_2002} that maximum likelihood variance estimations tends to be lower than real variances. We found that multiplying  $\sigma_{R}$  by a factor of 2 yielded the most precise and unbiased results in our simulations. Lastly, an informative normal prior for $log(\kappa)$ was included in the objective function (eq. \ref{pr.1}). In earlier versions of the model (results not shown), we found that it was difficult for the length-SRA to determine the difference between a large stock with low productivity and a small stock with high productivity. The inclusion of an informative prior on the $\kappa$ helps to solve this problem.




\begin{table}
\caption{Likelihood functions and penalties}\label{tab:LLpen} 
\tableEq
    \begin{align}
            \hline  
           \text{Conditional Likelihood }&&\nonumber\\
           \hline
            \label{PLL1}
            &Z_t = log(I_t)-log(VB_{t})\\
            \label{PLL2}
            &q = e^{\bar{Z}} \\
            \label{PLL3}
            &Zstat_t = Z_t - \bar{Z}  \\
            \label{PLL4} 
            &LL_{1} \sim \mathcal{N}(Zstat| \mu=0,\sigma=\sigma_{I_t})\\
            \mbox{Penalties}&&\nonumber\\
            \hline
            \label{pen.1}
            &P_{wt} \sim \begin{cases} \mathcal{N}(wt|\mu=0,\sigma=\sigma_{R}) &\quad phase < last phase\\
            \mathcal{N}(wt|\mu=0,\sigma=\sigma_{R} \cdot 2) & \quad phase = last phase \end{cases}\\
            \hline 
            \mbox{Priors} &&\nonumber \\ 
            \hline 
            \label{pr.1}
            &prior(log(\kappa)) \sim \mathcal{N}(log(\kappa), \sigma = 0.5)\\
             \hline  
            \mbox{Objective function}&&\nonumber\\
            \hline
            \label{Obj}
            &Obj = -log(LL_{1}) + (-log(P_{wt})) + prior(log(\kappa))\\ 
        \hline \hline \nonumber
    \end{align}
    \normalEq
\end{table}



\subsection{Simulation-evaluation}

Model performance was evaluated using a simulation-evaluation with the biological parameters of an hypothetical fish species. We used the same model structure described in Table \ref{tab:eqsPD} for both the simulation and estimation models. However, the operating model was modified to control annual exploitation rate (eq. \ref{OM1}), time-varying selectivity (eq. \ref{OM3}), and observation and process errors.


The simulation model was initialized at unfished conditions (eq. \ref{OM}) but only started  reporting data for the simulation-evaluation procedure after the $t_{init}$ year. Selectivity in the operating model was computed with the three parameter selectivity function described by \citet{thompson_confounding_1994} (eq. \ref{OM3}). We chose to use this three parameter selectivity curve because of its flexibility, which allowed us to switch between logistic and dome-shaped selectivity curves in the scenarios in which time-varying selectivity was considered. The observation error in the operating model included lognormal error in the index of abundance and logistic multivariate error \citep{schnute_influence_1995} in the catch numbers at length (Table \ref{tab:defOMmsy}). Recruitment deviations were assumed to be lognormally distributed with constant $\sigma_R$ (Table \ref{tab:defPD}).   

  

We considered a total of six different scenarios in simulation-evaluation trials, including three historical exploitation rate trajectories (contrast, one-way trip and $U$-ramp) and two selectivity patterns (constant and time-varying). In the contrast scenario the exploitation rate ($U_t$) starts low and increases beyond $U_{target}$ and then decreases until $U_t \approx U_{target}$. In the one-way trip scenario $U$ increased through time until $U \approx 2 \cdot U_{target} $. In the $U$-ramp scenario, $U_t$ increases steadily until $U_t \approx U_{target}$ and remains constant thereafter.  In the constant selectivity scenario, selectivity was assumed to follow a sigmoid shape. In the time-varying selectivity scenario, the selectivity curve was assumed to vary every year, progressively changing from a dome shaped curve to sigmoid and back to dome shaped. The complete list of scenarios and the acronyms used are presented in Table \ref{tab:simeval}. 

All simulations had 30 years of data and 200 simulation trials were performed for each scenario. We evaluated the distribution of the relative proportional error ($ \frac{esimated-simulated}{simulated}$) for the main parameter estimates ($R_{0}$, $R_{init}$, and $\kappa$) and for four derived quantities (Depletion: $\frac{SB_t}{SB_{0}}$, ${Yield}_{target}$, $U_{target}$, and $q$). 




\subsection{Misspecification of growth parameters - $L_{\infty}$}


One important feature of the Length-SRA is that it assumes that growth follows a von Bertalanffy curve and that the growth parameters are known and constant over time. If this assumption is violated, the model outcomes will be impacted as the model will try to explain the deviations from the true growth curve with changes in the selectivity pattern. Here we illustrate how the model outcomes are impacted by the misspecification of the $L_{\infty}$ growth parameter (Table \ref{tab:simeval}). We assumed a simple logistic selectivity curve for this exercise.



\begin{table}[ht!]
\centering
\caption{ \large Simulation-estimation scenarios for main simulations and $L_{\infty}$ sensitivity simulations }
\label{tab:simeval} 
 \begin{tabular}{c c c} 
 \hline
 Selectivity and fishing trajectory simulations &&\\
 \hline
 Scenario Code & Selectivity  & $U$ trajectory \\ 
 \hline
 CC     & constant       &  contrast    \\ 
 CO     & constant       & one-way trip  \\ 
 CR     & constant       & $U$-ramp  \\ 
 VC     & time-varying   &  contrast    \\ 
 VO     & time-varying   & one-way trip  \\ 
 VR     & time-varying   & $U$-ramp  \\  
 \hline
  $L_{\infty}$ sensitivity simulations &&\\
  \hline
Scenario Code & Version  & $L_{\infty}$ value \\ 
 \hline
 true        & true                  & 68  \\ 
 plus10       & 10\% overestimated    & 74.8  \\  
 minus10        & 10\% underestimated   & 61.2  \\ 
 \hline
\end{tabular}
\end{table}



\subsection{Real data examples}

Two case studies were chosen to illustrate the application of the Length-SRA to real datasets: Pacific hake and Peruvian jack mackerel. Both species are believed to be subject to time-varying selectivity. 

The Pacific hake fishery is believed to exhibit time-varying selectivity due to cohort targeting and annual changes fleet spatial distribution \citep{ruttan_finding_2003}. The population is know to have spasmodic recruitment, with high recruitment  events occurring once or twice every decade \citep{ressler_pacific_2007}. Pacific hake tends to segregate by size during their annual migration \citep{ressler_pacific_2007}, allowing the fishing fleet to target strong cohorts by changing the spatial distribution of fishing effort as the cohort ages. Hake catch at length data was available for the period between 1975 and 2013. The survey index of abundance was available intermittently from 1995 to 2013. 

The movement pattern of jack mackerel is not as well known, although fish appear to move between spawning and feeding areas \citep{gerlotto_insight_2012}. Variability in selectivity patterns for the jack mackerel fishery are believed to be associated both with evolution of fleet capacity and gear utilization and with compression and expansion of the species range associated with abundance changes \citep{gerlotto_insight_2012}. Jack mackerel catch at length data was available from 1980 to 2013 and the survey index was available between 1986 and 2013, with the exception of 2010. 



\section{Results}

\subsection{Simulation-evaluation}


We evaluated the performance of the model in relation to the main parameters and derived management quantities with boxplots of the relative proportional error. Relative proportional error was calculated based on the maximum likelihood estimates of each parameter between the 200 simulated populations for each scenario. Throughout we use the terms positive and negative median bias to indicate that the median relative proportional error is above or below zero. The median relative proportional error sign indicates if a parameter has been underestimated or overestimated the majority of the time.


Simulation-evaluation of the Length-SRA model resulted in positive median bias for all three of the main parameters (Figure \ref{mainParams}). The $R_0$ relative error estimates had similar median bias and precision across all scenarios, with slightly higher absolute median bias for the fixed selectivity scenario (Figure \ref{mainParams} - top panel). The $R_{init}$ median relative error was more prominently positively biased for all scenarios when compared to other parameters. The absolute median relative error was higher for the CC, CO and VO scenarios (see Table \ref{tab:simeval} for scenario description). However the precision of the relative error estimates were similar across all scenarios (Figure \ref{mainParams} - second panel). The relative error estimates for $\kappa$ indicate that this parameter was nearly unbiased, an effect of the informative prior considered for that parameter (Figure \ref{mainParams} - bottom panel).




\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.65]{Figure1.pdf}
  \caption{Relative proportional error for main parameters for all scenarios considered in the simulation-evaluation. Boxplots center lines indicate the median estimate. Lower and upper hinges indicate first and third quartiles. Upper and lower whiskers are given by the maximum and minimum values within the intervals given by the hinge value +/- 1.5 $\cdot$ inter-quartile range (distance between the first and third quartiles). }
\label{mainParams}
\end{figure}


The depletion ($SB_t/SB_o$) estimates resulted in negative median relative error for all scenarios except for VO (Figure \ref{derivQuant} - top panel). $Yield_{target}$ median relative error was overestimated for all scenarios, but the absolute median relative error was relatively low ($<7\%$) (Figure \ref{derivQuant} - second panel). The $U_{target}$ relative error estimates were the most variable, with median relative errors ranging from negative (CC scenario) to unbiased ( VC and VO scenarios) to positive (CO, CR and VR). In addition, the precision in the estimates of $U_{target}$ seem to be associated with the exploitation history; the contrast scenarios had the most accurate estimates and the one-way trip the most variable (albeit least biased) estimates (Figure \ref{derivQuant} - third panel). The estimates of $q$ were the most precise of the derived quantities. However, marked positive biases for the contrast and time-varying selectivity scenario (VC) and $U$-ramp scenarios (CR and VR) (Figure \ref{derivQuant} - bottom panel) .




\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.65]{Figure2.pdf}
  \caption{Relative proportional error for main parameters for all scenarios considered in the simulation-evaluation. Boxplots center lines indicate the median estimate. Lower and upper hinges indicate first and third quartiles. Upper and lower whiskers are given by the maximum and minimum values within the intervals given by the hinge value +/- 1.5 $\cdot$inter-quartile range (distance between the first and third quartiles). }
\label{derivQuant}
\end{figure} 

 
 The simulation-evaluation exercise showed that the Length-SRA model is able to track the median estimates of selectivity changes through time (Figure \ref{sel}). However the selectivity estimates are quite variable, which is likely due to the observation error in the catch at length composition.  

\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.5]{Figure3.pdf}
  \caption{Simulated and realized selectivity estimates for a set of years within simulation-evaluation time series. The estimated solid lines indicate median, 2.5\% and 97.5\% quantiles for the derived selectivities. Dashed lines are three individual estimates, for illustration purposes. }
\label{sel}
\end{figure}

\subsection{Misspecification of growth parameters}

We found that misspecification of $L_{\infty}$ has severe implications in the capability of the model to estimate exploitation rate at length $U_{l,t}$(Figure \ref{UbiasLinf}). If the value of $L_{\infty}$ was specified to be lower than true, the estimates of $U_{l,t}$ were lower than true for most length and extremely high for high lengths (approaching the true $L_{\infty}$ ). In the scenario where $L_{\infty}$ was reported to be higher than true, $U_{l,t}$ was estimated to follow a dome shaped pattern, with very low exploitation rates for the higher lengths. These patterns occur because the model is trying to adjust the mismatch between proportions of catch at length and the $P_{l|a}$ matrix by changing the predicted selectivity pattern.  As a result, failure to adequately specify $L_{\infty}$ leads to erroneous estimation of selectivity patterns and, consequently, failure in estimating management quantities. 





\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.85,width=\textwidth]{Figure4.pdf}
  \caption{Simulated and realized exploitation rate at length $U_{l,t}$ when $L_{\infty}$ is misspecified. Results shown for the last four years of simulation-evaluation time series. Boxplots center lines indicate the median estimate. Lower and upper hinges indicate first and third quartiles. Upper and lower whiskers are given by the maximum and minimum values within the intervals given by the hinge value +/- 1.5 $\cdot$ inter-quartile range (distance between the first and third quartiles).}
\label{UbiasLinf}
\end{figure}


\subsection{Real data examples}



The model fit the Pacific hake and jack mackerel indexes of abundance relatively well (Figure \ref{it}), despite some limitation in the available data. The Pacific hake index of abundance time series is relatively short and intermittent (survey happens every two or three years). The index of abundance time series for jack mackerel was longer but it indicates a downward trend in abundance with low contrast in the last ten years of data. 

 The model fit for both species resulted in time-varying selectivities that lead to variation in $Yield_{target}$ and consequent changes in $U_{target}$ (Figure \ref{it}). This is because changes in selectivity result in changes to the vulnerable biomass even if total biomass is constant. A sharp peak in both  $Yield_{target}$ and $U_{target}$ is shown for both Pacific hake and jack mackerel. We believe these peaks are likely unrealistic and are associated with difficulties in estimating recruitment deviations in the early years.   


  The selectivity curves estimated for Pacific hake and jack mackerel are quite variable and mostly estimated to be dome shaped (Figure \ref{selreal}). It is important to note that this observed variability might indicate real changes in selectivity (e.g. cohort targeting) or might also be caused by misspecification of the growth parameters (see Figure \ref{UbiasLinf}). At this point it impossible to determine the causes for the resulting patterns in selectivity observed with the Length-SRA fit. Further investigation would be needed if this model is to be used for management purposes. 
  



\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.7,width=\textwidth]{Figure5.pdf}
  \caption{Fit to index of abundance, historical catches, and $Yield_{target}$ and $U_{target}$ estimates for Pacific hake and jack mackerel.}
\label{it}
\end{figure}


\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.7]{Figure6.pdf}
  \caption{Estimated selectivity patterns across years for Pacific hake and jack mackerel.}
\label{selreal}
\end{figure}




\section{Discussion}


We present a length-based stock reduction analysis (Length-SRA) that allows monitoring of time-varying selectivity.  In the Length-SRA model, catch at length is assumed to be known without error and exploitation rate at length is calculated directly from estimates of numbers at length. In turn, numbers at length are produced based on numbers at age and on probabilities derived from growth curve parameters and the assumed variability (standard deviation) around mean length at age. This fact is important because it allows the model to bypass the requirement for the estimation of a selectivity curve, as is required in more traditional age- and  length-based models \citep[][e.g.]{sullivan_catch-at-length_1990,mesnil_hybrid_1990} and in more recent length based state-space modelling approaches \citep{white_fitting_2016}. Estimation of selectivity ogives can be very difficult, especially if selectivity is believed to vary over time unpredictably \citep{martell_towards_2014,linton_catch-at-age_2011}.  



\citet{nielsen_estimation_2014} presents a stock assessment approach that accounts for time varying selectivity by treating fishing mortality at age as process error estimated within a state-space approach and allowing autocorrelation over ages and time . The accuracy in the estimates of selectivity obtained with the Length-SRA are comparable with those presented by \citet{nielsen_estimation_2014}, especially for the  one-way trip scenarios. The Length-SRA selectivity estimates are less precise than those shown by \citet{nielsen_estimation_2014}, likely because the Length-SRA estimates incorporate observation error.  Their model seems to perform extremely well, however they only considered one exploitation rate trajectory, with significant contrast in the data. In addition, the changes in selectivity considered in their study are more subtle than the ones considered here.

 %The accuracy in the estimates of selectivity obtained with the Length-SRA are comparable with those presented by \citet{nielsen_estimation_2014}, especially for the  one-way trip scenarios. The Length-SRA selectivity estimates are less precise than those shown by \citet{nielsen_estimation_2014}, likely because the Length-SRA estimates incorporate observation error. The \citet{nielsen_estimation_2014} approach accounts for time-varying selectivity by treating fishing mortality at age as stochastic processes that are correlated over age and time. Their model seems to perform extremely well, however they only considered one exploitation rate trajectory, with significant contrast in the data. In addition, the changes in selectivity considered in their study are more subtle than the ones considered here.

Another attractive approach to model catch at length data is the one described by \citet{white_fitting_2016}. Their state-space model estimates annual recruitment, harvest rate, and error terms from catch at length data and seems to obtain good  precision and accuracy in their estimates. However, it is important to note that their model relies on two assumptions that are likely violated in real data examples. First, they assume that selectivity is constant over time and follows a cumulative normal distribution parametric form. Second, they assume that the growth component of the transition matrix (probabilities of age given length) to be constant and given by the growth curve. This is incorrect because fishing causes changes in the age composition of fish of size x, i.e. under fishing,  proportion of younger fish in a given length/size class is expected to increase. 



An important advancement of Length-SRA over conventional stock-assessment models is the indirect calculation of time-varying selectivity. This information alone can be used  to characterize the complexity of the fishery system. Length-SRA on its own is reasonably accurate in deriving important management-oriented parameters (depletion and $Yield_{target}$). However another option may be to combine findings from this model with another assessment model, such as a statistical catch at age (SCA) model. In this framework, Length-SRA can be used to calculate annual selectivity patterns and provide an indication of possible changes over time.  These selectivity estimates can then become an input into an SCA to calculate other important variables and produce management advice. This combination of models has been used in the past \citep{walters_placing_1994}; we suggest Length-SRA may be a useful tool in this context.


Accurate estimates of selectivity are particularly important if the fishery management is based on yield per recruit reference points. Fishery yield per recruit depends on the selectivity curve \citep{beverton_dynamics_1957} and for this reason, changes in selectivity over time will directly affect reference points \citep{beverton_dynamics_1957,hilborn_quantitative_1992}. We observed selectivity changes for both Pacific hake and jack mackerel and show how this variability can lead to a difference between the maximum and minimum estimates of $Yield_{target}$ and  $U_{target}$ calculated along the time series. We believe that tracking these changes is important not only to ensure appropriate management recommendations, but also to illustrate the relationship between selectivity patterns and management targets \citep{vasilakopoulos_unfulfilled_2016}.

One potential point of concern that should be considered when using the Length-SRA is that it assumes that the biological parameters used in the growth curve and catch at age relationship are know without error and constant over time. We have tested the Length-SRA under misspecification of the $L_{\infty}$ von Bertalanffy parameter and we observed additional bias in the estimates of parameter and management quantities as well as strong distortions in the resulting selectivity parameters. Similarly, \citet{minte-vera_get_2017} showed that misspecification in biological parameters, especially in asymptotic length, can have a significant impact in assessment results. Other length models, e.g. MULTIFAN-CL \citep{fournier_multifan-cl:_1998}, overcome the assumption of known growth parameters by estimating the von Bertalanffy parameters alongside the assessment parameters. The estimation of the growth parameters is made possible by assuming that selectivity follows a parametric function (usually logistic). Once a simple selectivity curve is assumed, all deviations in observed catch at length are explained by adjusting the growth parameters. This assumption can also lead to bias in parameter estimates, as other studies show that variability in selectivity and non-asymptotic patterns are common \citep{waterhouse_using_2014}. In reality, in most cases it is difficult to know if patterns observed in catch at length are caused by fisheries targeting (i.e. selectivity) or if they would be more appropriately explained by adjusting the growth parameters. Therefore, we recommend that, when using the Length-SRA, the user should  perform extensive sensitivity analyses over the possible range of values for the growth parameters using, for example, the predictive distributions given by the FishLife package \citep{thorson_predicting_2017}. Sensitivity analyses are  particularly important if the predicted selectivity patterns are highly variable. 



As mentioned previously, the model and simulation exercise presented here assumes that the growth parameters are known and constant through time. Consequently, time variability in growth patterns could also impact the results produced by the model. We would not recommend attempting to estimate time-varying growth parameters within the Length-SRA because growth and exploitation rates at length are confounded. However, if estimates of time-varying growth are available, preferably from fishery independent data, those could be used as an input to the Length-SRA model.


 The approach used in the Length-SRA is analogous to that used in virtual population analysis in that the length composition data is assumed to be known without error. For this reason, the selectivity estimates include extra variability due to observation and sampling error. We attempted to minimize this effect by smoothing the predicted selectivity over two years, however this method is not capable of completely removing the observation error effect from the selectivity estimates. Because of the assumption of known catch at length, it is important that the catch sampling is representative of the total removals from the population \citep{pope_investigation_1972}. Collecting length composition information on commercial catch can be very challenging, and the resulting length composition data can be subject to high variability. \citet{gulland_review_1992} cover many examples of how difficulties may arise when sampling length of the catch and provide some very useful advice on how to initiate and design length composition sampling programs. As in any other fisheries model, biased sampling and/or low sampling effort will result in bias in parameter and fishery reference point estimates \citep{coggins_simulation_1998,bunch_measurement_2013}. 


Some management parameters are consistently overestimated ($Yield_{target}$) and underestimated (depletion) which may be cause for concern. However, it is important to note that both parameters have low absolute  median relative error (<7\%). The magnitude of the bias in the estimates of $Yield_{target}$ and $U_{target}$  observed in this study are comparable (in magnitude) to the results obtained by \citet{martell_towards_2014} for $MSY$ and $F_{MSY}$ in a simulation study on the impacts of time-varying selectivity on the estimates generated by a statistical catch at age model. Other studies show even higher biases in face of time-varying selectivity \citep[e.g.][]{linton_catch-at-age_2011,henriquez_interactions_2016}. The estimates of depletion are also comparable to those produced with other SRA type assessments evaluated by \citet{thorson_catch_2015}. Overall, parameter and derived parameters estimates are generally within the range of many other stock assessment models.  

 The Length-SRA approach presented in this study can be a useful tool for fisheries stock assessment. We believe that this is particularly true when time-varying selectivity is thought to occur, especially if the variability is not easily predictable from historical changes in gear use/fleet composition. However, we would like to acknowledge that the selectivity estimates will only be reliable if the growth parameters for the population being assessed are known. In addition, the simple nature of the Length-SRA model makes it a good candidate model for inclusion on closed-loop simulation studies. Further testing of this model in a closed-loop simulation set up would provide more insight on the model performance on achieving management outcomes \citep{punt_management_2014}. We foresee the application of this model as an investigative tool to evaluate potential time-varying selectivity patterns, as a stock assessment tool and as part of closed loop simulation studies.



\section{Acknowledgments}
 We would like to thank Allan Hicks and NOAA for the provision of Pacific hake data and Instituto del Mar del Peru (IMARPE) for the provision of jack mackerel data. 

\clearpage

\bibliographystyle{fish}
\bibliography{references}




\end{document}
