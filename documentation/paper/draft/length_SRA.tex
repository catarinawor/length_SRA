
\documentclass{article}


\usepackage{pgf} %nice pictures
\usepackage{rotating}

\usepackage[left=1.2in,right=1.2in,top=1.2in,bottom=1.2in]{geometry} % sets the margins

\usepackage{fancyhdr}
\usepackage{setspace}

\usepackage{titlesec}
\usepackage{natbib}
\usepackage{checkend}   % better error messages on left-open environments
\usepackage{graphicx}   % for incorporating external images


\usepackage{times,mathptmx,courier}
\usepackage[scaled=1]{helvet}


%% Math or theory people may want to include the handy AMS macros
\usepackage{amssymb}
\usepackage{amsmath}
\usepackage{amsfonts}
\usepackage{float}

\usepackage[printonlyused,nohyperlinks]{acronym}

\usepackage{comment}


%% \url{http://...} 
\usepackage{url}

\usepackage{gensymb}

\usepackage{lineno}


\usepackage[french,english]{babel}
\usepackage[T1]{fontenc}

\usepackage{listings}

\doublespacing

%move all figures to the end
\usepackage[nomarkers,nofiglist,notablist]{endfloat}



\titleformat*{\section}{\singlespacing\raggedright\bfseries\Large}
\titleformat*{\subsection}{\singlespacing\raggedright\bfseries\large}
\titleformat*{\subsubsection}{\singlespacing\raggedright\bfseries}
\titleformat*{\paragraph}{\singlespacing\raggedright\itshape}





\usepackage[bookmarks,bookmarksnumbered,%
    citebordercolor={0.8 0.8 0.8},filebordercolor={0.8 0.8 0.8},%
    linkbordercolor={0.8 0.8 0.8},%pagebordercolor={0.8 0.8 0.8},
    urlbordercolor={0.8 0.8 0.8},
    linktocpage%
    ]{hyperref}
%%\usepackage[bookmarks,bookmarksnumbered,%
%%    citebordercolor={0.8 0.8 0.8},filebordercolor={0.8 0.8 0.8},%
%%    linkbordercolor={0.8 0.8 0.8},pagebordercolor={0.8 0.8 0.8},%
%%    urlbordercolor={0.8 0.8 0.8},%
%%    pagebackref,linktocpage%
%%    ]{hyperref}
%% The following change how the the back-references text is typeset in a
%% bibliography when `backref' or `pagebackref' are used
%\renewcommand\backrefpagesname{\(\rightarrow\) pages}
%\renewcommand\backref{\textcolor{greytext} \backrefpagesname\ }

%allow use of \degree command
\usepackage{gensymb}

\usepackage{lineno}
\linenumbers
\bibpunct{(}{)}{;}{a}{}{;}


%% The following is used for tables of equations.
\newcounter{saveEq} 
\def\putEq{\setcounter{saveEq}{\value{equation}}} 
\def\getEq{\setcounter{equation}{\value{saveEq}}} 
\def 
\tableEq{ 

% equations in tables
\putEq \setcounter{equation}{0} 
\renewcommand{\theequation}{T\arabic{table}.\arabic{equation}} \vspace{-5mm} } 
\def\normalEq{ 

% renew normal equations
\getEq 
\renewcommand{\theequation}{\arabic{section}.\arabic{equation}}}
\newcommand{\normal}[2]{\ensuremath{N(#1,#2)}}



%%%%%%%% Author macros begin:
\newcommand*{\affaddr}[1]{#1} % No op here. Customize it for different styles.
\newcommand*{\affmark}[1][*]{\textsuperscript{#1}}
\newcommand*{\email}[1]{\texttt{#1}}
%%%%%%%% Author macros end



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% Some special settings that controls how text is typeset
%%
 \raggedbottom      % pages don't have to line up nicely on the last line
% \sloppy       % be a bit more relaxed in inter-word spacing
 \clubpenalty=10000 % try harder to avoid orphans
 \widowpenalty=20000    % try harder to avoid widows
% \tolerance=1000



\begin{document}

\title{Stock Reduction Analysis using catch at length data: Length-SRA}   

\author{%
Catarina Wor\affmark[1,a,*], Brett van Poorten\affmark[1,2,b], Roberto Licandeo \affmark[1,c],\\, and Carl J. Walters\affmark[1,d] \\
\affaddr{\affmark[1]Institute for the Oceans and Fisheries, University of British Columbia, 2202 Main Mall,\\
 Vancouver, BC Canada, V6T 1Z4}\\
\affaddr{\affmark[2] British Columbia Ministry of Environment, 2202 Main Mall, Vancouver, BC, Canada, V6T 1Z4}\\
\email{\affmark[a]c.wor@oceans.ubc.ca}\\
\email{\affmark[b]Brett.VanPoorten@gov.bc.ca}\\
\email{\affmark[c]robertolicandeo@gmail.com}\\
\email{\affmark[d]c.walters@oceans.ubc.ca}\\
%,
 \affmark[*]Corresponding author, phone:+1 604 908 4626
}



\maketitle

\begin{abstract}
Many modern stock assessments convert length frequency data from catches to age compositions to then conduct age-structured assessment. These assessments must estimate age- or length-based vulnerability to fishing, often using simple parametric functions describing asymptotic or dome-shaped vulnerability. We present a length-based stock reduction analysis (Length-SRA), which bypasses the requirement of estimating a vulnerability by estimating exploitation rate at length directly from observed catch at length data. We test the performance of Length-SRA with a simulation-evaluation framework under three exploitation rate trajectories and under fixed and time-varying vulnerability scenarios. The model yields relatively low bias in parameter estimates and  management benchmarks. Length-SRA is relatively accurate when tracking changes in vulnerability through time. We further use Length-SRA to assess two species, Pacific hake and Peruvian jack mackerel, to show that vulnerability is quite variable in both species over time, leading to time-varying management reference points.  Length-SRA provides assessment results with accuracy comparable to other methods, such as Virtual Population Analysis and Statistical Catch at Age. However, Length-SRA has the additional advantage of providing accurate estimates of vulnerability over time.



\end{abstract}


\section{Introduction}


Modern stock assessments typically attempt to fit population dynamics models to catch at age and catch at length data, in hopes of extracting information from these data about age/size vulnerability, cohort strength and fishing mortality patterns \citep{methot_stock_2013,hilborn_quantitative_1992}. Some assessment methods attempt to put aside the length frequency data, by converting these data to age compositions using age-from-length tables, perhaps using iterative methods to estimate proportions of fish at age for each length interval \citep{kimura_mixtures_1987}. In cases where age data are lacking, models like MULTIFAN-CL attempt to obtain estimates of vulnerability, fishing mortality and population dynamics parameters only from size distribution data \citep{fournier_multifan-cl:_1998}. Combined with a few assumptions regarding the structure and variability in length at age, this procedure can even be used to attempt to recover information about changes in body growth patterns if there is a strong age-class signal in the length frequency data \citep{fournier_multifan-cl:_1998}.    It is typical for assessment results from length-based assessment models to show substantial deviations between predicted and observed length distributions of catches, reflecting both sampling variation in the length composition data and incorrect assumptions about stability of growth and vulnerability patterns \citep{hilborn_quantitative_1992}. 
 
Vulnerability to fishing is the combination of two processes: selectivity of the fishing gear and availability of the fished population in the area being fished \citep{beverton_dynamics_1957}. Both processes can vary over time and therefore modify the resulting selectivity. Although selectivity process can often be directly measured through gear experiments, availability is generally harder to measure as it depends on the size-based distribution of the exploited population and the spatial distribution of the fishing fleet. Fish movement, size-structured changes in fish distribution, and changes in fleet distribution, can all affect availability and consequently lead to vulnerability changes. Changes in vulnerability are not uncommon \citep{sampson_exploration_2012} but are usually difficult to track over time. This difficulty is associated with an inability to distinguish between changes in fishing mortality and changes in vulnerability in most age- and length-based stock assessment methods. For this reason, many assessment methods rely on ad hoc parametric vulnerability models that may or may not include changes over time \citep{maunder_selectivity:_2014}. If misspecified, such models might lead to severe bias in fishing mortality estimates and other model parameters, which could result in misleading management advice \citep{martell_towards_2014}. 

 Here we suggest an alternative approach to assessment modeling that begins by assuming that the assessment model should exactly reproduce the observed catch at length composition. This approach follows the dynamics of an age structured stock reduction analysis (SRA) \citep{walters_stochastic_2006,kimura_generalized_1984,kimura_stock_1982} which follows a ``conditioned on catch'' format, subtracting observed catches at age from modeled numbers at age in estimation of numbers at age over time. This assumption is analogous to the classical assumption in virtual population analysis that reconstructed numbers at age should exactly match observed catch at age data \citep{hilborn_quantitative_1992}. The suggested approach may have two key advantages over statistical catch at age and/or catch at length models: (1) it does not require estimation of age or size vulnerability schedules, and (2) catch at length data are commonly available for every year, even when age composition sampling has not been conducted. 

 We named this approach a Length-SRA assessment model. Here we present the model formulation, demonstrate its performance with a simulation-evaluation analysis and apply it to real fisheries data from the Peruvian jack mackerel (\emph{Trachurus murphyi}) and Pacific hake (\emph{Merluccius productus}) fisheries. 



\section{Methods}

%In this section we describe the stock reduction analysis with catch at length data (Length-SRA), describe the simulation analysis and scenarios used to test the model and provide a description of the real data used to illustrate the model applicability.


\subsection{Stock reduction analysis with catch at length data - length-SRA}

The stock reduction analysis (SRA) described here proceeds through the following steps: (1) compute numbers at age (based on recruitment estimates and mortality in the previous year); (2) convert numbers at age into numbers at length using the proportions of individuals at length given each age class; (3) calculate the exploitation rate at length using numbers at length and observed catch at length; (3) convert the exploitation rate at length to exploitation rate at age; (4) compute numbers in the following year using the exploitation rate at age, natural mortality, and recruitment estimates.  


A crucial component of the length-SRA is the calculation of proportions of individual at length given each age class ($P_{l|a}$ - eqs. \ref{Pla1.1}-\ref{Pla1.5}). The calculation of such proportions (eq. \ref{Pla1.1}) relies on four main assumptions regarding the distribution of length at age: (1) The mean length at age follows a von Bertalanffy growth curve (eq.\ref{Pla1.4}), (2) The length at age is normally distributed (eqs. \ref{Pla1.1} -\ref{Pla1.3}), (3) The standard deviation of the length at age is defined (e.g. eq.\ref{Pla1.5}), and (4) $P_{L|a}$ is constant for all lengths equal or greater than a maximum length $L$ (eq.\ref{Pla1.3}).



 The proportions of length at age are used to convert the length-based quantities into age-based quantities which are used to propagate the age structured population dynamics forward (Table \ref{tab:eqsPD}). We assume that recruitment follows a Beverton-Holt type recruitment curve (eq. \ref{PD2.1}), that harvesting occurs over a short, discrete season in each time step (year or shorter time period), and that natural survival rate is known and stable over time (eqs. \ref{PD2.1}-\ref{PD2.5}).  The computation of numbers at age in the initial year (i.e., first year in which data is reported - $t_{init}$) is different from that in the remaining years (eq. \ref{AO.1}). Recruitment in the initial year is given by the parameter $R_{init}$ which is used to indicate that the population was not at equilibrium at the start of the time series. 

We used equilibrium spawner per recruit (SPR) quantities to calculate management targets, for illustration purposes we use 40\% as a SPR target and use  ${Yield}_{SPR=40\%}$ and $U_{SPR=40\%}$ as target management benchmarks (Table \ref{tab:eqsOMmsy} - eqs.\ref{lz} to \ref{umsy}). As in all spawner per recruit calculations, our $Yield_{target}$ and $U_{target}$ estimates depend on the vulnerability curves calculated for each year (eq. \ref{phieq}).  


 To assess how well the model tracked changes in vulnerability over time, we calculated the resulting vulnerability estimates by normalizing the yearly vectors of exploitation rate at length ($U_{l,t}$) by the yearly average exploitation rate at length ($\bar{U_{l}}$) (eq. \ref{sel.est}), which is more stable than the maximum yearly exploitation rate ($max{U_{l}}$). This happens because observation errors tend to average out over the length classes, diminishing variability of $\bar{U_{l}}$ in relation to $max{U_{l}}$. When calculating the management targets, we used the same method to calculate the mean vulnerability at age (eq. \ref{selage.est}), however we also averaged the selectivity at age curves over the past two years (eq. \ref{selage.est}) in order to further smooth the curves.   



\begin{table}
  %\centering
  %\large
\caption{ \large Indexes, stock assessment variable definition, and values used in simulation-evaluation}\label{tab:defPD} 
\begin{tabular}{l c p{7.5cm}} 
\hline
Symbol & Value  & Description \\  
\hline
  $l$ & $\{l_o,...,L\}$ &Central point of length bin,  $L=50$ cma\\
  $a$ & $\{a_o,...,A\}$ &Age-class, $A=10 years$\\  
  $t$ & $\{1,...,T\}$ &Annual time step, $T=50 years$\\
  $a_o$ & $1$ &First age or age of recruitment \\
  $l_bin$ & $2$ cm &size of length bin \\
  $l_o$ & $8$ cm &Central point of first length bin \\
  $init$ & $21$ &Annual time step in which data starts to be reported \\
\hline
Distribution of length given age&&\\
${L_{\infty}}$ &50 cm & Maximum average length\\
${K}$ &0.15& Rate of approach to $L_{\infty}$\\
${t_o}$& -0.1&Theoretical time in which length of individuals is zero\\
$cv_l$ & 0.08 & Coefficient of variation for length at age curve\\
$P_{l|a}$ & &Matrix of proportions of length at age\\
$\Phi$ && Standard normal distribution\\
$z1_{a,l}$ &&Normalized $z$ score for lower limit length bins\\
$z2_{a,l}$&& Normalized $z$ score for upper limit length bins \\
$b1_{l}$ &&  Lower limit of length bins\\
$b2_{l}$ &&  Upper limit of length bins \\    
$\bar{L}_a$&&   Mean length at age\\
$\sigma_{L}$ && Standard deviation of length at age\\
\hline
Population dynamics&&\\
$R_o$& 100& Average unfished recruitment\\
$\kappa$ &10&  Goodyear recruitment compensation ratio\\
$S$ &0.7& Natural annual survival \\
$\sigma_{R} $& 0.6 & standard deviation for recruitment deviations\\
$w_t$& $\mathcal{N}(0,\sigma_{R})$ &  Recruitment deviations for  years \{init-A+1,...,T\} \\
$N_{a,t}$ &&  Numbers of fish at age and time\\
$SB_{t}$ && Spawning biomass at time\\
$mat_a$ && Proportion of mature individuals at age\\
$a_{rec}, b_{rec}$ && Beverton \& Holt stock recruitment parameters \\
$R_{init}$& & Recruitment in the year data starts to be reported \\
$U_{a,init}$ &&  Exploitation rate at age before data starts being reported. \\
$U_{a,t}$ && Exploitation rate at age and time\\
$U_{l,t}$ && Exploitation rate at length and time \\
$C_{l,t}$ && Catch at length and time\\
$N_{l,t}$ && Numbers at length and time \\
$lx_a$ && Unfished survivorship at age\\
$\Phi_e$ && Unfished average spawning biomass per recruit \\
$vul^{result}_{l,t} $ && Resulting vulnerability estimates at length and time \\
\hline
\hline
\end{tabular}
\end{table}

\begin{table}
  %\centering
  %\large
\caption{ \large Indexes, variable definition for operating model, MSY quantities, and values used in simulation-evaluation}\label{tab:defOMmsy} 
\begin{tabular}{l c p{7.5cm}} 
\hline
Symbol & Value  & Description \\  
\hline
Operating model &&\\
$vul^{OM}_{l,t}$ && Fishing vulnerability at length and time\\
$g,d,b$ &vary by scenario& Parameters for selectivity function \\
$U_{t}$ &vary by scenario&  Annual maximum exploitation rate \\
$C^{Sim}_{l,t}$ && Simulated catch at length and time\\
$N^{Sim}_{l,t}$ && Simulated numbers at length and time\\
$I_{t}$ && Index of abundance at time \\
$\sigma_{I_t} $& 0.1 & standard deviation for index of abundance deviates\\
$VB_{t}$ && Biomass that is vulnerable to the survey at time \\
$q$ &1.0& Catchability coefficient \\
\hline
Managemen quantities &&\\
$lz_a$&& Fished survivorship at age\\
$F_z$&seq(0.0,1.0,by=0.001)& Hypothetical average fishing mortality to calculate management targets\\
$\Phi_z$ && Average spawning biomass per recruit\\
$\Phi_{eq}$&& Average exploited biomass per recruit under $U_z$\\
$vul^{result}_{a,t}$&& Vulnerability at age and time t \\
$R_{eq}$ &&Average equilibrium recruitment under $U_z$\\
${Yield}_{z}$ &&Equilibrium yield under $U_z$\\
${Yield}_{target}$  && Yield that would reduce spawner per recruit to 40\% of unfished levels\\
$U_{target}$ &&Exploitation rate that reduce spawner per recruit to 40\% of unfished levels \\  
\hline
\hline
\end{tabular}
\end{table}


\begin{table}
  %\centering
  %\large
\caption{population dynamics for Length-SRA and operating model}\label{tab:eqsPD} 
\tableEq
    \begin{align}
          % \hline
        %\hline \nonumber \\ 
            \hline  
           \text{Distribution of length given age}&&\nonumber\\
           \hline
            \label{Pla1.1}
            P_{l|a} &= \int_{z1_{a,l}}^{z2_{a,l}}{ \Phi(z) dz} \\
            \label{Pla1.2}
            z1_{a,l} &= \frac{b1_{l} - \bar{L}_{a}}{\sigma_{L_{a}}} \\
            \label{Pla1.3}
            z2_{a,l} &= \begin{cases}\frac{b2_{l} - \bar{L}_{a}}{\sigma_{L_{a}}} &\quad l<L  \\
             1.0 &\quad l=L \\
             \end{cases}\\
            \label{Pla1.4} 
            \bar{L}_{a} &= L_{\infty} \cdot (1 - e^{(-K\cdot(a-t_o))})  \\
            \label{Pla1.5} 
            \sigma_{L_{a}} &= \bar{L}_{a} \cdot cv_l  \\
            %\nonumber \\
            \hline  
            \mbox{Population dynamics}&&\nonumber\\
            \hline
            \label{PD2.1}
             N_{a,t>init}&=\begin{cases} \frac{a_{rec} \cdot SB_{t-1}}{1+ b_{rec} \cdot SB_{t-1}} \cdot e^{w_t}, &\quad a=a_o  \\
            %
            N_{a-1,t-1}\cdot S \cdot (1-U_{a-1,t-1}),&\quad a_o<a<A  \\
            %
            \frac{N_{a-1,t-1} \cdot S \cdot (1-U_{a-1,t-1})}{1- S \cdot (1-U{a,t})},&\quad a=A \\
            \end{cases}\\
            \label{PD2.2}
            U_{a,t}&=\sum_l{(P_{l|a}\cdot U_{l,t})}\\
            \label{PD2.3}
            U_{l,t}&=\frac{C_{l,t}}{N_{l,t}}\\
            \label{PD2.4}
            N_{l,t}&=\sum_a{(P_{l|a}\cdot N_{a,t})}\\
            \label{PD2.5}
            SB_{t}&= \sum_a(mat_a \cdot w_a \cdot N_{a,t}) \\ 
            \label{sel.est}
            vul^{result}_{l,t}&=  \frac{U_{l,t}}{\bar{U_{t}}} \\
           %\nonumber \\
            \hline 
            \mbox{Initial year and incidence functions} &&\nonumber \\ 
            \hline 
            \label{AO.1}
            %N_{a=1,init}&= R_{init} \cdot e^{w_{init}} \\
             N_{a,init}&= lx_a \cdot R_{init} \cdot e^{w_{init}}\\
            \label{AO.2}
            a_{rec}&=  \frac{\kappa}{\Phi_e} \\
            \label{AO.4}
            b_{rec}&= \frac{\kappa-1}{R_o \cdot \Phi_e}  \\
             \label{AO.5}
            \Phi_e &= \sum_a{lx_a \cdot mat_a \cdot w_a} \\
            \label{AO.6}
            lx_a &= \begin{cases} 1 , &\quad a=1 \\
            lx_{a-1} \cdot S ,&\quad 1<a<A \\ 
            \frac{lx_{a-1} \cdot S}{1-S} ,&\quad a=A \\
             \end{cases}\\       
             %\nonumber \\
        \hline \hline \nonumber
    \end{align}
    \normalEq
\end{table}


The Length-SRA model estimates three main parameters: average unexploited recruitment $R_{0}$, recruitment compensation ratio $\kappa$, and recruitment in the initial year $R_{init}$. In addition, the annual recruitment deviations $w_t$ are estimated for all cohorts observed in the model. That is, the number of recruitment deviations is equal to the number of years in the time series plus the number of age classes greater than recruitment age.  



\begin{table}
  %\centering
  %\large
\caption{Management quantities and operating model}\label{tab:eqsOMmsy} 
\tableEq
    \begin{align}
           \hline
        %\hline \nonumber \\ 
            \mbox{Operating model}&&\nonumber\\
            \hline
            \label{OM4}
             N^{Sim}_{a,t=1}&= lx_a \cdot R_o\\
            \label{OM4.1}
            U_{l,t}&= U_{t} \cdot vul^{OM}_{l,t}\\
            \label{OM4.2}          
            C^{Sim}_{l,t}&= N^{Sim}_{l,t} \cdot  U_{l,t} \cdot P_{l|a} \\
            \label{OM4.3}
            vul^{OM}_{l,t} &= \frac{1}{1-g}\cdot \left(\frac{1-g}{g}\right)^{g} \cdot \frac{e^{d\cdot g\cdot (b-l)}}{1+e^{d\cdot(b-l)}}\\
            \label{OM4.4}
            I_{t}&= q \cdot VB_{t} \cdot e^{(\mathcal{N}(0,\sigma_{I_t}))}\\ 
            \hline  
           \text{Management quantities}&&\nonumber\\
           \hline
            \label{lz}
            lz_a &= \begin{cases} lz_a=1 &\quad a=a_o\\
              lz_{a-1}\cdot S \cdot exp(-F_z \cdot  vul^{result}_{a-1,t}) &\quad a_o<a<A\\
              \frac{lz_{a-1}\cdot S \cdot exp(-F_z \cdot  vul^{result}_{a-1,t})}{1-S\cdot exp(-F_z \cdot  vul^{result}_{A,t})}&\quad a=A\\\end{cases}\\
              \label{selage.est}
             vul^{result}_{a,t} &= \frac{\frac{U_{a,t-1}}{\bar{U}_{t-1}}+ \frac{U_{a,t}}{\bar{U}_{t}}}{2}\\
             %selage(y)= value(Uage(y)/max(Uage(y))+Uage(y-1)/max(Uage(y-1)))/2.;
            \label{phiz}
            \Phi_z &= \sum_a{lz_a \cdot mat_a \cdot w_a}\\
            \label{phieq}
            Target_{\Phi} &= |\frac{\Phi_z}{\Phi_e}-0.4| \\
            \label{phitarget}
            %tmp_target(k) = fabs(value(tmp_phiz(k)/phie - target));
            \Phi_{eq} &= \sum_a{lz_a \cdot  (1-exp(-F_z*vul^{result}_{a,t})) \cdot w_a} \\
             \label{Req}
             R_{eq} &= R_o \cdot \frac{\kappa - \Phi_e/\Phi_z}{\kappa-1}\\
             \label{yz}
             Yield_z&= R_{eq}\cdot \Phi_{eq}\\
             \label{msy}
             Yield_{target} &=Yield_z  \rightarrow min(Target_{\Phi}) \\
             \label{umsy}
             U_{target} &= 1-exp(-F_z) \rightarrow min(Target_{\Phi})\\
        \hline \hline \nonumber
    \end{align}
    \normalEq
\end{table}



The objective function (eq. \ref{Obj}) is composed of a negative log-likelihood component, one penalty, and a prior component for the recruitment compensation ratio $\kappa$. The negative log-likelihood component minimizes the differences between the predicted and observed index of abundance (eq. \ref{PLL.1}). We assume that such differences are lognormally distributed (eqs. \ref{PLL.3}-\ref{PLL.4}) and use the conditional maximum likelihood estimator described by \citet{walters_calculation_1994} to estimate the survey catchability coefficient $q$ (eq. \ref{PLL.2}). A lognormal penalty is added to the negative log-likelihood function to constrain annual recruitment residuals so  estimates have mean of zero and fixed standard deviation $\sigma_{R}$ \citep{maunder_estimation_2003} (eq. \ref{pen.1}). Lastly, an informative normal prior for $log(\kappa)$ was included in the objective function (eq. \ref{pr.1}).


%\begin{table}
  %\centering
  %\large
%\caption{Estimated parameters, likelihood functions and penalties}\label{tab:LLpen} 
%\begin{tabular}{l p{7.cm}} 
%\hline
%Likelihood &\\
%$Z_t = log(I_t)-log(VB_{t})$&\\\\
%$q = e^(\bar{Z})$ & Estimate of the catchability coefficient\\\\
%$Zstat_t = Z_t - \bar{Z}$&\\\\ 
%$\mathcal{L}_{I_{t}}= \sum(-log(\mathcal{N}(Zstat_t; 0,\sigma_{I_t})))$& %Negative log likelihood\\\\
%\hline
%Penalties&\\
%$posfun(1-U_{l,t},0.01,fpen)$ & The posfun function is a penalty function implemented in ADMB\\
%$pen(U)=\frac{\sum^{t}\sum^{l}{U_{l,t}}}{T}$ &Additional penalty to prevent values of $U_{l,t} > 1$ \\\\
%$pen(w_t)=\sum (- log(\mathcal{N}(w_t; 0,\sigma_{R})))$ & Penalty on recruitment residuals \\\\
%\hline
%Priors&\\
%$prior(log(\kappa)) = \mathcal{N}( log(10), 0.9)$&\\\\
%\hline
%Objective function&\\
%$Obj = \mathcal{L}_{I_{t}} + pen(w_t)+ pen(U) + prior(log(\kappa))$  &\\
%\hline
%\hline
%\end{tabular}
%\end{table}


\begin{table}
\caption{Likelihood functions and penalties}\label{tab:LLpen} 
\tableEq
    \begin{align}
          % \hline
        %\hline \nonumber \\ 
            \hline  
           \text{Conditional Likelihood }&&\nonumber\\
           \hline
            \label{PLL.1}
            &Z_t = log(I_t)-log(VB_{t})\\
            \label{PLL.2}
            &q = e^{\bar{Z}} \\
            \label{PLL.3}
            &Zstat_t = Z_t - \bar{Z}  \\
            \label{PLL.4} 
            &LL_{1} \sim \mathcal{N}(Zstat| \mu=0,\sigma=\sigma_{I_t})\\
            \mbox{Penalties}&&\nonumber\\
            \hline
            \label{pen.1}
            &P_{wt} \sim \mathcal{N}(wt|\mu=0,\sigma=\sigma_{R})\\
            %\label{pen.2}
            % posfun(1-U_{l,t},0.01,fpen) \\       
            %&\mu_{U_{t-2:t}} = \left(\sum_{t-2}^{t}{\frac{U_{l,t}}{\bar{U_{t}}}}\right)/3\\
            %&U^{pen}_{t}={\left(\frac{U_{l,t}}{\bar{U_{t}}} - \mu_{U_{t-2:t}}\right)}^{2} \\
            %&SS_{vul}=\sum_{t=3}^{t=T}{U^{pen}_{t}}\\
            %\label{pen.3}
            %&P_{U}=\frac{SS_{vul}}{\sigma_{vul}}\\
            %&\sigma_{vul} = 200\\
            %\label{pen.4}
            %&P_{U_{max}}=\sum^{t}\sum^{l}{{U_{t,l}}^{10}}\\
            %penmaxUy(syr) = sum(pow( Ulength( syr )(1,nlen),10));
            \hline 
            \mbox{Priors} &&\nonumber \\ 
            \hline 
            \label{pr.1}
            &prior(log(\kappa)) \sim \mathcal{N}(log(\kappa), \sigma = 0.6)\\
             \hline  
            \mbox{Objective function}&&\nonumber\\
            \hline
            \label{Obj}
            &Obj = -log(LL_{1}) + (-log(P_{wt})) + prior(log(\kappa))\\ 
        \hline \hline \nonumber
    \end{align}
    \normalEq
\end{table}



\subsection{Simulation-evaluation}

Model performance was evaluated using a simulation-evaluation populated with the biological parameters of an hypothetical fish species. We used the same model structure described in Table \ref{tab:eqsPD} for both the simulation and estimation models. However, the operating model was modified to control annual exploitation rate (eq. \ref{OM4.1}), time varying selectivity (eq. \ref{OM4.3}), and observation and process errors.


The simulation model was initialized at unfished conditions (eq. \ref{OM4}) but only started  reporting data for the simulation-evaluation procedure after the $t_{init}$ year. Selectivity in the operating model was computed with the three parameter selectivity function described by \citet{thompson_confounding_1994} (eq. \ref{OM4.3}). We chose to use this three parameter selectivity curve because of its flexibility, which allowed us to switch between logistic and dome-shaped selectivity curves in the scenarios in which time varying selectivity was considered. The observation error in the operating model included lognormal error in the index of abundance and logistic multivariate error \citep{schnute_influence_1995} in the catch numbers at length (Table \ref{tab:defOMmsy}). Recruitment deviations were assumed to be lognormally distributed with constant $\sigma_R$ (Table \ref{tab:defPD}).   

  

We considered a total of six different scenarios in simulation-evaluation trials, including three historical exploitation rate trajectories (contrast, one-way trip and $U$-ramp) and two selectivity patterns (constant and time-varying). In the contrast scenario the exploitation rate ($U_t$) starts low and increases beyond $U_{MSY}$ and then decreases until $U_t=U_{MSY}$. In the one-way trip scenario $U$ increased through time until $U=2 \cdot U_{MSY} $. In the $U$-ramp scenario, $U_t$ increases steadily until $U_t=U_{MSY}$ and remains constant thereafter.  In the constant selectivity scenario, selectivity was assumed to follow a sigmoid shape. In the time varying selectivity scenario, the selectivity curve was assumed to vary every year, progressively changing from a dome shaped curve to sigmoid and back to dome shaped. The complete list of scenarios and the acronym used for them is presented in Table \ref{tab:simeval}. 

All simulations had 30 years of data and 200 simulation trials were performed for each scenario. We evaluated the distribution of the relative proportional error ($ \frac{esimated-simulated}{simulated}$) for the main parameter estimates ($R_{0}$, $R_{init}$, and $\kappa$) and for four derived quantities (Depletion: $\frac{SB_t}{SB_{0}}$, ${Yield}_{target}$, $U_{target}$, and $q$). 


\begin{table}[ht!]
\centering
\caption{ \large Simulation-estimation scenarios}
\label{tab:simeval} 
 \begin{tabular}{c c c} 
 \hline
 Scenario Code & Selectivity  & $U$ trajectory \\ 
 \hline
 CC     & constant   &  contrast    \\ 
 CO     & constant   & one-way trip  \\ 
 CR     & constant   & $U$-ramp  \\ 
 VC     & time-varying   &  contrast    \\ 
 VO     & time-varying   & one-way trip  \\ 
 VR     & time-varying   & $U$-ramp  \\  
 \hline
\end{tabular}
\end{table}


\subsection{Real data examples}

Two case studies were chosen to illustrate the application of the Length-SRA to real datasets: Pacific hake and Peruvian jack mackerel. Both species are believed to be subject to time varying selectivity. 

The Pacific hake fishery is believed to exhibit time varying selectivity due to cohort targeting and annual changes fleet spatial distribution \citep{ruttan_finding_2003}. The population is know to have spasmodic recruitment, with high recruitment  events occurring once or twice every decade \citep{ressler_pacific_2007}. Pacific hake tends to segregate by size during their annual migration \citep{ressler_pacific_2007}, allowing the fishing fleet to target strong cohorts by changing the spatial distribution of fishing effort as the cohort ages. Hake catch at length data was available for the period between 1975 and 2013. The survey index of abundance was available intermittently from 1995 to 2013. 

The movement pattern of jack mackerel is not as well known, although fish appear to move between spawning and feeding areas \citep{gerlotto_insight_2012}. Variability in selectivity patterns for the jack mackerel fishery are believed to be associated both with evolution of fleet capacity and gear utilization and with compression and expansion of the species range associated with abundance changes \citep{gerlotto_insight_2012}. Jack mackerel catch at length data was available from 1980 to 2013 and the survey index was available between 1986 and 2013, with the exception of 2010. 



\section{Results}

\subsection{Simulation-evaluation}


We evaluated the performance of the model in relation to the main parameters and derived management quantities with boxplots of the relative proportional error. Throughout we use the terms positive and negative median bias to indicate that the median relative proportional error is above or below zero. The median relative proportional error sign indicate if a parameter has been underestimated or overestimated the majority of the time.

Simulation-evaluation of Length-SRA model resulted in a small positive median bias for the $\kappa$ parameter across all scenarios (Figure \ref{mainParams}). The $R_0$ relative error medians were positively biased for the contrast and one-way-trip scenarios (CC, CO, VC and VO) and negatively biased for the $U$-ramp scenarios (Figure \ref{mainParams}). The $R_{init}$  median relative error was negatively biased for all scenarios with higher absolute biases associated with the contrast scenario with time-varying selectivity (VC) and $U$-ramp scenarios (CR and VR) (Figure \ref{mainParams}). Overall, The contrast with constant selectivity and one-way trip scenarios yielded the best performance. 



\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.65]{/Users/catarinawor/Documents/Length_SRA/R/plots/figs/main_params_publ.pdf}
  \caption{Relative proportional error for main parameters for all scenarios considered in the simulation-evaluation. Boxplots center lines indicate the median estimate. Lower and upper hinges indicate first and third quartiles. Upper and lower whiskers are given by the maximum and minimum values within the intervals given by the hinge value +/- 1.5 * inter-quartile range (distance between the first and third quartiles). }
\label{mainParams}
\end{figure}



The depletion ($SB_t/SB_o$) estimates resulted in negative median relative error for all scenarios (Figure \ref{derivQuant}). $MSY$ was also underestimated for most senarios, except for the contrast scenario with constant vulnerability, for which the median relative proportional error was zero. The estimates for $U_{MSY}$ showed very low ($<$0.071) absolute median proportional errors for all scenarios (Figure \ref{derivQuant}). The estimates of $q$ were more variable, with particularly high positive bias for the the contrast and time-varying selectivity scenario (VC) and $U$-ramp scenarios (CR and VR). The overestimation in q is likely associated with the more severe underestimations of and $R_{init}$ and $MSY$ for those scenarios as both $R_{init}$ and $MSY$ are negatively correlated with $q$.

\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.65]{/Users/catarinawor/Documents/Length_SRA/R/plots/figs/derivQuant_publ.pdf}
  \caption{Relative proportional error for main parameters for all scenarios considered in the simulation-evaluation. Boxplots center lines indicate the median estimate. Lower and upper hinges indicate first and third quartiles. Upper and lower whiskers are given by the maximum and minimum values within the intervals given by the hinge value +/- 1.5 * inter-quartile range (distance between the first and third quartiles). }
\label{derivQuant}
\end{figure} 

 
 The simulation-evaluation exercise showed that the Length-SRA model is able to track vulnerability for the CC, CO and VO scenarios (Figure \ref{sel}). The capability of the model to track vulnerability through time was diminished for the CR, VC and VR scenarios. The decreased accuracy for the CR, VC and VR scenarios is likely associated with the lack of information in the data, this was an expected outcome for the $U$-ramp scenarios (CR and VR) but it was somewhat unexpected for the  contrast scenario with time varying vulnerability (VC). However, upon closer inspection of the biomass trends in the VC scenario (results not shown), we realized that the interaction between time-varying vulnerability and changes in exploitation rate resulted in a somewhat stable biomass trend over time resulting in lack of contrast in the time series.
 


\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.5]{/Users/catarinawor/Documents/Length_SRA/R/plots/figs/sel_publ.pdf}
  \caption{Simulated and realized selectivity estimates for a set of years within simulation-evaluation time series.}
\label{sel}
\end{figure}



\subsection{Real data examples}



The model fit the Pacific hake and jack mackerel indexes of abundance relatively well (Figure \ref{it}), despite some limitation in the available data. The Pacific hake index of abundance time-series is quite short and intermittent (survey happens every two or three years). The index of abundance time series for jack mackerel was longer but it indicates a downward trend in abundance with low contrast in the last ten years of data.   


 The model fit for both species resulted in time varying selectivities that lead to variation in $MSY$ and consequent changes in $U_{MSY}$. This is because changes in selectivity result in changes to the vulnerable biomass even if total biomass is constant. The time-varying selectivity calculated for each species  (Figure \ref{selreal}) results in up to two-fold change in $MSY$ throughout the time series for both species (Figure \ref{it}). The selectivity curves estimated for Pacific hake and jack mackerel are quite variable. It is important to note that this observed variability might indicate real changes in selectivity (e.g. cohort targeting) or might also be caused by misspecification of the growth parameters (see Appendix). At this point it impossible to determine what are the causes for the resulting patterns in vulnerability observed with the Length-SRA fit. Further investigation would be needed if this model is to be used for management purposes. 
  




\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.85,width=\textwidth]{/Users/catarinawor/Documents/Length_SRA/R/plots/figs/real_examples.pdf}
  \caption{Fit to index of abundance for Pacific hake and jack mackerel.}
\label{it}
\end{figure}


\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.7]{/Users/catarinawor/Documents/Length_SRA/R/plots/figs/real_selectivities.pdf}
  \caption{Realized selectivity patterns across years for Pacific hake and jack mackerel.}
\label{selreal}
\end{figure}




\section{Discussion}




We present a length-based stock reduction analysis (Length-SRA) that allows monitoring of time varying vulnerability.  In the Length-SRA model, catch at length is assumed to be known without error and exploitation rate at length is calculated directly from estimates of numbers at length. In turn, numbers at length are produced based on numbers at age and on probabilities derived from growth curve parameters and coefficient of variation. This fact is important because it allows the model to bypass the requirement for the estimation of a vulnerability ogive, as is required in more traditional age- and  length-based models \citep[][e.g.]{sullivan_catch-at-length_1990,mesnil_hybrid_1990} and in more recent length based state-space modelling approaches \citep{white_fitting_2016}. Estimation of vulnerability ogives can be very difficult, especially if vulnerability is believed to vary over time unpredictably \citep{martell_towards_2014,linton_catch-at-age_2011}.  



 The accuracy in the estimates of vulnerability obtained with the Length-SRA are comparable with those presented by \citet{nielsen_estimation_2014}, especially for the  one-way trip scenarios (scenarios with the most informative data). The Length-SRA selectivity estimates are less precise than those shown by \citet{nielsen_estimation_2014}, likely because the Length-SRA estimates incorporate observation error. The \citet{nielsen_estimation_2014} approach account for time varying selectivity by treating fishing mortality at age as stochastic processes that are correlated over age and time. Their model seems to perform extremely well, however they only considered one exploitation rate trajectory, with significant contrast in the data. In addition, the changes in vulnerability considered in their study are  more subtle than the ones considered here.

Another attractive approach to model catch at length data is the one described by \citet{white_fitting_2016}. Their state space model estimates annual recruitment, harvest rate, and error terms from catch at length data and seems to obtain good  precision and accuracy in their estimates. However, it is important to note that their model relies on two assumptions that are likely violated in real data examples. First, they assume that vulnerability is constant over time and follows a cumulative normal distribution parametric form. Second, they assume that the growth component of the transition matrix P(y,x) to be constant and given by the growth curve. This is incorrect because fishing causes changes in the age composition of fish of size x, i.e. under fishing,  proportion of younger fish (with higher y$|$x) is expected to increase. 



An important advancement of Length-SRA over conventional stock-assessment models is a calculation of time-varying vulnerability. This information alone will go a long way in helping to characterize the complexity of the fishery system. Length-SRA on its own is reasonably accurate in deriving important management-oriented parameters (depletion and $U_{MSY}$), however another option may be to combine findings from this model with another assessment model, such as a statistical catch at age (SCA) model. In this framework, Length-SRA can be used to calculate annual vulnerability, which are reasonably accurate of there is enough contrast in the biomass time series.  These vulnerability estimates can then become an input into an SCA to calculate other important variables and produce management advice. This combination of models has been used in the past \citep{walters_placing_1994}; we suggest Length-SRA may be a  useful tool in this context. 

Accurate estimates of vulnerability are particularly important if the fishery management is based on yield per recruit reference points. Fishery yield per recruit depends on the vulnerability curve \citep{beverton_dynamics_1957} and for this reason, changes in vulnerability over time will directly affect reference points \citep{beverton_dynamics_1957,hilborn_quantitative_1992}. We observed vulnerability changes for both Pacific hake and jack mackerel and show how this variability can lead to a two-fold difference between the maximum and minimum estimates of $MSY$ calculated along the time series. We believe that tracking these changes is important not only to ensure appropriate management recommendations, but also to illustrate the relationship between vulnerability patterns and $MSY$ \citep{vasilakopoulos_unfulfilled_2016}.

One potential point of concern that should be considered when using the Length-SRA is that it assumes that the biological parameters used in the growth curve and catch at age relationship are know without error and constant over time. We have tested the Length-SRA under misspecification of the von Bertalanffy growth parameters (see Appendix) and we observed additional bias in the estimates of parameter and management quantities as well as stong distortions in the resulting selectivity parameters. Similarly, \citet{minte-vera_get_2017} showed that misspecification in biological parameters, especially in asymptotic length, can have a significant impact in assessment results. Other length models, e.g. MULTIFAN-CL \citep{fournier_multifan-cl:_1998}, overcome the assumption of known growth parameters by estimating the von Bertalanffy parameters alongside the assessment parameters. The estimation of the growth parameters is made possible by assuming that vulnerability follows a parametric function (usually logistic). Once a simple vulnerability curve is assumed, all deviations in observed catch at length are explained by adjusting the growth parameters. This assumption can also lead to bias in parameter estimates, as other studies show that variability in selectivity and non-asymptotic patterns are common \citep{waterhouse_using_2014}. In reality, in most cases it is difficult to know if patterns observed in catch at length are caused by fisheries targeting (i.e. vulnerability) or if they would be more appropriately explained by adjusting the growth parameters. Therefore, we recommend that, when using the Length-SRA, the user should  perform extensive sensitivity analyses over the possible range of values for the growth parameters, particularly if the predicted vulnerability patterns are highly variable.


 The approach used in the Length-SRA is analogous to that used in virtual population analysis in that the length composition data is assumed to be known without error. For this reason, the vulnerability estimates include extra variability due to observation and sampling error. We attempted to minimize this effect by adding a the time varying vulnerability penalty to the objective function, however this penalty is not capable of completely removing the observation error effect from the vulnerability estimates. Because of the assumption of known catch at length, it is important that the catch sampling is representative of the total removals from the population \citep{pope_investigation_1972}. As in any other fisheries model, biased sampling and/or low sampling effort will result in bias in parameter and fishery reference point estimates \citep{coggins_simulation_1998,bunch_measurement_2013}. 


Some management parameters are underestimated (namely depletion and $MSY$ in most scenarios) and the relative error indicated that the estimates are not very precise which may be cause for concern. However, it is important to note that both parameters are underestimated for the majority of scenarios and simulation runs, which leads to conservative management recommendations. Although this may lead to losses in catch in the short-term, it will result in healthier stocks and higher catches over the longer-term (once the stock is recovered). The magnitude of bias is also dependent on the trajectory of the data: time-series with more contrast will lead to more accurate estimates. The magnitude and direction of the bias in the estimates of $MSY$ and depletion observed in this study are comparable to the results obtained by \citet{martell_towards_2014} in a simulation study on the impacts of time varying vulnerability on the estimates generated by a statistical catch at age model. Other studies show even higher biases in face of time-varying vulnerabilities \citep[e.g.][]{linton_catch-at-age_2011,henriquez_interactions_2016}. Overall, parameter and derived parameters estimates are generally within the range of many other stock assessment models.  

The simple nature of the Length-SRA model makes it a good candidate model for inclusion on closed-loop simulation studies. Further testing of this model in a closed-loop simulation set up would provide more insight on the model performance on achieving management outcomes \citep{punt_management_2014}. As mentioned before, we expect that the length-SRA, when used as an assessment tool, will yield slightly conservative management benchmarks which might lead to higher average catch in the long term if the stock is currently overfished. However, it is also possible that these conservative benchmarks result in forgone yield in the medium and long term. We recommend, therefore that this approach be tested in  a simulation set up before it is considered as part of a management strategy. 

In conclusion, we believe that the Length-SRA approach presented in this study is a useful approach to fisheries stock assessment. We believe that this is particularly true when time varying vulnerability is believed to occur, especially if the variability is not easily predictable from historical changes in gear use/fleet composition. We foresee the application of this model as an investigative tool to evaluate potential time-varying vulnerability patterns, as a stock assessment tool and as part of closed loop simulation studies.



%\subsection{ lit overview - might be useful}

%The model is not that good, main parameters are biased and selectivity estimates are not particularly accurate or precise - compare with simeval of other models. Is it really that bad?
%Comparison with other Simeval models - summaries that might be useful for this discussion:

%Anderson et. al 2014 - SS3sim. Scenarios fix/estimated M and $\sigma_R = 0.1 $ or $0.4$. 
%The Simeval show almost no bias in SSB with quantiles of relatve erros between 0.2 and -0.2. 
%Management quantities are hard to tell (no median bar) but axis range fro -0.6 to 0.6. 

%Linton and Bence 2011 - catch at age mode in face of time-varying selectivity. 
%Biomass seem unbiased but relative error axis goes up to 1500 \%. 


%Martell and Steward 2014- Towards defining good practices with time varying selectivity. 
%Comparable bias/variability in management quantities with axis ranging from -0.2 to 0.2. 
 
  
%Main talking points:
%\begin{itemize}
%  \item The model is not that good, main parameters are biased and selectivity estimates are not particularly accurate or precise - compare with simeval of other models. Is it really that bad?
%  \item Why is this failing? - Drop this point
%  \item Is this still useful?
%  \item Depletion and MSY are underestimated -  the model tends to produce conservative benchmarks.
%  \item Further testing of this model in a closed-loop simulation set up would provide more insight on the model performance on achieving management outcomes
%\end{itemize}

\section{Acknowledgments}
 We would like to thank Allan Hicks and NOAA for the provision of Pacific hake data and Instituto del Mar del PerÃº (IMARPE) for the provision of jack mackerel data. 

\clearpage

\bibliographystyle{apa}
\bibliography{references}

\appendix
\section{Appendix}

One important feature of the Length-SRA is that it assumes that growth follows a von Bertalanffy curve and that the growth parameters are known and constant over time. If this assumption is violated, the model outcomes will be impacted as the model will try to explain the deviations from the true growth curve with changes in the vulnerability pattern. Here we illustrate how the model outcomes are impacted by the misspecification of the growth parameters by purposefully misreporting the values of $L_{\infty}$ (Table \ref{tab:biasedLinf}). We assumed a simple logistic selectivity curve for this exercise and therefore expect the model to produce logistic patterns in the exploitation rate at length $U_{l,t}$.

We found that misspecification of $L_{\infty}$ has severe implications in the capability of the model to estimate exploitation rate at length $U_{l,t}$(Figure \ref{UbiasLinf}). If the value of $L_{\infty}$ was reported to be lower than true, the estimates of $U_{l,t}$ were lower than true for most length and extremely high for high lengths (approaching the true $L_{\infty}$ ). In the scenario where $L_{\infty}$ was reported to be higher than true, $U_{l,t}$ was estimated to follow a dome shaped pattern, with very low exploitation rates for the higher lengths. This patterns occur because the model is trying to adjust the mismatch between proportions of catch at length and the $P_{l|a}$ matrix by changing the predicted vulnerability pattern.  As a result, failure to adequately specify $L_{\infty}$ leads to erroneous estimation of vulnerability patterns and, consequently, to failure in estimating management quantities. 



\begin{table}[ht!]
\centering
\large
\caption{ \large Scenarios for testing misspecification of $L_{\infty}$}
\label{tab:biasedLinf} 
 \begin{tabular}{l c c } 
 \hline
 Scenario name & version  & $L_{\infty}$ value \\ 
 \hline
 true        & true                  & 68  \\ 
 minus10        & 10\% underestimated   & 61.2  \\ 
 plus10       & 10\% overestimated    & 74.8  \\  
 \hline
\end{tabular}
\end{table}


\begin{figure}[htbp]
  \centering
  \includegraphics[scale=.85,width=\textwidth]{/Users/catarinawor/Documents/Length_SRA/R/plots/figs/sel_ALinf.pdf}
  \caption{Simulated and realized exploitation rate at length $U_{l,t}$ for a set of years within simulation-evaluation time series.}
\label{UbiasLinf}
\end{figure}


\end{document}
